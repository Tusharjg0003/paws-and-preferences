<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Paws & Preferences: Find Your Favourite Kitty</title>
  <meta name="description" content="Swipe through cats from CATAAS. Like (right) or dislike (left), then see your favourites." />
  <link rel="preconnect" href="https://cataas.com" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap" rel="stylesheet" />
  <style>
    /* --------- Mobile-first (iPhone 14 Pro friendly) --------- */
    :root{
      --bg:#ffffff; --fg:#0B1220; --muted:#5b6b7c; --accent:#ff3aa7;
      --like:#16a34a; --nope:#dc2626;

      /* tuned for 390x844 */
      --card-w:min(88vw, 340px);
      --card-h:min(60vh, 500px);

      --poster-space: 36px;
      --border: 1.2px;
      --radius: 16px;

      --header-bg:#fff5fa;       /* very light pink */
      --header-border:#ffd3e6;   /* soft pink border */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:#fff; color:var(--fg);
      font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      -webkit-tap-highlight-color:transparent;
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      overscroll-behavior-y:contain;
      padding: 0 10px;
    }

    .app{
      min-height:100%;
      display:grid; grid-template-rows:auto 1fr auto;
      place-items:center; gap:12px; padding:18px 0;
      position:relative; overflow:hidden;
      padding-top: calc(14px + env(safe-area-inset-top));
      padding-bottom: calc(14px + env(safe-area-inset-bottom));
    }

    /* Header (sticky, light pink) */
    header{
      position:sticky; top:0; z-index:10;
      display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:8px;
      width:100%; padding:10px 12px; background:var(--header-bg);
      border-bottom:1px solid var(--header-border);
      backdrop-filter:saturate(1) blur(2px);
    }
    header h1{
      margin:0; justify-self:center; text-align:center; display:inline-flex; align-items:center; gap:8px;
      font-family:"Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial;
      font-size:clamp(1.35rem, 6.4vw, 2.05rem); letter-spacing:.2px; font-weight:800; white-space:nowrap;
      background:linear-gradient(90deg,#111 0%, #ff3aa7 35%, #ffb6c9 55%, #ffc56f 75%, #111 100%);
      background-size:320% 100%;
      -webkit-background-clip:text; background-clip:text; color:transparent;
      -webkit-text-stroke:.8px #000; text-shadow:1px 1px 0 #000,-1px 1px 0 #000,1px -1px 0 #000,-1px -1px 0 #000;
      animation:brandShift 9s linear infinite;
    }
    @keyframes brandShift{0%{background-position:0% 50%}100%{background-position:320% 50%}}
    .brand-wrap{display:flex; align-items:center; gap:8px; justify-self:start}
    .brand-paw{animation:pawBounce 2.2s ease-in-out infinite; transform-origin:60% 60%}
    @keyframes pawBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
    .title-icon{display:inline-grid; place-items:center}
    .title-icon svg{ width:22px; height:22px; filter:drop-shadow(0 1px 0 #0006) }
    .title-icon svg path{ stroke:#000; stroke-width:1.5 }
    .title-icon svg .fill{ fill:url(#pawGrad) }
    .title-icon.animate{ animation:pawNod 2.6s ease-in-out infinite }
    @keyframes pawNod{0%,100%{transform:rotate(0)}50%{transform:rotate(-6deg)}}

    /* Card stack */
    .stack{position:relative;width:var(--card-w);height:var(--card-h);z-index:2}
    .card{
      position:absolute; inset:0; border-radius:var(--radius); overflow:hidden; background:#ffffff;
      border:var(--border) solid #111; box-shadow:0 18px 60px #0002; user-select:none;
      touch-action:pan-y; -webkit-tap-highlight-color:transparent;
    }
    .card:focus, .card:focus-visible{ outline:none }

    .ph{position:absolute;inset:0;background:linear-gradient(90deg,#eee 25%,#f7f7f7 37%,#eee 63%);background-size:400% 100%;animation:shimmer 1.1s infinite}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:contrast(1.02) saturate(1.06)}
    .badge{position:absolute;top:14px;padding:.45rem .6rem;border-radius:10px;font-weight:800;letter-spacing:.6px;font-size:.9rem;border:3px solid transparent;transform:rotate(-8deg);opacity:0;transition:.2s}
    .badge.like{left:14px;color:#102417;background:#22c55e22;border-color:#22c55e}
    .badge.nope{right:14px;transform:rotate(8deg);color:#2a0f12;background:#ef444422;border-color:#ef4444}
    .scrim{position:absolute;inset:0;background:linear-gradient(to top, #0006 0 35%, transparent 65%)}
    .meta{
      position:absolute;bottom:10px;left:12px;right:12px;display:flex;align-items:flex-end;justify-content:space-between;gap:10px;
      backdrop-filter:blur(10px);background:#ffffffcc;border:1px solid #111;border-radius:14px;padding:10px 12px
    }
    .meta .title{font-size:1.02rem;font-weight:800}
    .meta .idx{font-size:.85rem;color:var(--muted)}

    /* Arena: [poster][card][poster] */
    .arena{
      position:relative;
      display:grid;
      grid-template-columns: var(--card-w);
      justify-content:center; align-items:center; gap:6px; width:100%; margin-inline:auto;
      max-width:100%;
    }

    /* Mobile controls */
    .controls{display:flex; gap:14px; align-items:center; justify-content:center; width:100%; max-width:min(88vw, 420px)}
    .fab{
      border:var(--border) solid #111; background:#fff; color:#000; border-radius:999px;
      width:64px; height:64px; display:grid; place-items:center; box-shadow:0 10px 30px #00000010;
      transition:transform .12s ease, box-shadow .12s ease; user-select:none
    }
    .fab:active{ transform:scale(.96); box-shadow:0 6px 18px #00000012 }
    .fab svg{ width:28px; height:28px }

    /* Poster hints */
    .side-hint{
      grid-row:1; align-self:center; justify-self:center; z-index:3;
      font-weight:900; letter-spacing:2px; text-align:center; line-height:1.1;
      color:#ff3aa7; -webkit-text-stroke:1px #000;
      text-shadow:1px 1px 0 #000,-1px 1px 0 #000,1px -1px 0 #000,-1px -1px 0 #000;
      opacity:.25; transition: opacity .18s ease, transform .18s ease;
      font-size: clamp(11px, 3.6vw, 22px);
      user-select:none; pointer-events:none;
    }
    .side-hint.left{ grid-column:1; transform: rotate(-4deg) }
    .side-hint.right{ grid-column:3; transform: rotate(4deg) }
    .side-hint.active{ opacity:.7 }
    .side-hint.left.active{ transform: rotate(-4deg) scale(1.06) }
    .side-hint.right.active{ transform: rotate(4deg) scale(1.06) }

    /* How-to */
    .howto{z-index:3;width:100%;display:flex;justify-content:center}
    .howto-inner{ margin:6px 0 8px; padding:6px 8px; background:#fff; border:1px solid #111; border-radius:999px;
      box-shadow:0 6px 24px #0000000d; font-size:.9rem; text-align:center }

    /* Paws */
    .paws{position:absolute;inset:0;overflow:hidden;pointer-events:none;z-index:1}
    .paw{position:absolute;opacity:.10;animation:floatUp linear infinite;filter:drop-shadow(0 2px 0 #0002)}
    @keyframes floatUp{from{transform:translateY(110vh) rotate(0deg)}to{transform:translateY(-20vh) rotate(25deg)}}

    /* Progress */
    .progress{width:min(88vw,340px);height:6px;background:#00000010;border:1px solid #111;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#ff3aa7,#111);transition:width .25s}

    /* Summary (single-column on mobile) */
    .summary{display:none;max-width:min(94vw,980px)}
    .summary.show{display:block}
    .grid{column-count:1; column-gap:12px}
    .grid img{
      width:100%; height:auto; display:block; margin:0 0 12px;
      border-radius:12px; border:var(--border) solid #111; break-inside:avoid; background:#fff;
    }
    .chip{font-size:.9rem;color:var(--muted)}

    @media (prefers-reduced-motion: reduce){ .card{transition:none!important} }
    @media (prefers-reduced-motion: reduce){ header h1{ animation:none } .brand-paw{ animation:none } }
    @media (max-width:360px){
      :root{ --poster-space: 24px }
      .fab{ width:56px; height:56px }
    }

    /* ====== NEW: Floating Emoji Layer ====== */
    .emojis{position:absolute; inset:0; pointer-events:none; overflow:hidden; z-index:2}
    .emo{
      position:absolute; will-change:transform, opacity;
      font-size: clamp(18px, 4vw, 28px);
      opacity:.0; animation: floatEmoji linear forwards;
      filter: drop-shadow(0 2px 0 #0002);
    }
    @keyframes floatEmoji{
      0%{ transform: translate(var(--x,0), 110vh) scale(var(--s,1)) rotate(0deg); opacity:0 }
      10%{ opacity:.35 }
      85%{ opacity:.35 }
      100%{ transform: translate(calc(var(--x,0) + var(--drift, 0px)), -10vh) scale(var(--s,1)) rotate(20deg); opacity:0 }
    }
    /* ======================================= */
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="paws" id="paws" aria-hidden="true"></div>
    <!-- NEW: emoji layer -->
    <div class="emojis" id="emojis" aria-hidden="true"></div>

    <header>
      <div class="brand-wrap" aria-hidden="true"></div>
      <h1>
        <span class="title-icon animate" aria-hidden="true">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="pawGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ff3aa7"/>
                <stop offset="50%" stop-color="#ffb6c9"/>
                <stop offset="100%" stop-color="#ffc56f"/>
              </linearGradient>
            </defs>
            <!-- Simple cat face silhouette -->
            <path d="M4 9c0-1 .8-3 2.2-3.8L8 4l2 2h4l2-2 1.8 1.2C18.8 6 20 8 20 9c0 5-3.8 8-8 8s-8-3-8-8Z" class="fill"/>
            <circle cx="9.2" cy="10.4" r=".9" fill="#000"/>
            <circle cx="14.8" cy="10.4" r=".9" fill="#000"/>
            <path d="M9 13c1 .7 2 .7 3 0" fill="none" stroke="#000" stroke-width="1.2" stroke-linecap="round"/>
          </svg>
        </span>
        <span class="title-text">Paws & Preferences</span>
      </h1>
      <div style="width:28px;justify-self:end" aria-hidden="true"></div>
    </header>

    <div class="howto" id="howto" role="status" aria-live="polite">
      <div class="howto-inner">Swipe <strong>left</strong> to dislike · Swipe <strong>right</strong> to like</div>
    </div>

    <div class="arena">
      <div class="stack" id="stack" aria-live="polite"></div>
    </div>

    <div class="controls" aria-label="Actions">
      <button id="btnNope" class="fab nope" aria-label="Dislike">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" stroke="#dc2626" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
      <button id="btnLike" class="fab like" aria-label="Like">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 21s-6-4.5-9-8A5.5 5.5 0 0 1 12 5a5.5 5.5 0 0 1 9 8c-3 3.5-9 8-9 8Z" stroke="#16a34a" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>

    <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>

    <section class="summary" id="summary" aria-labelledby="sum-h">
      <h2 id="sum-h">Your favourites</h2>
      <p class="chip"><span id="likedCount">0</span> liked out of <span id="totalCount">0</span></p>
      <div class="grid" id="likedGrid"></div>
      <div class="summary-actions" style="margin-top:14px;display:flex;gap:10px;width:100%;max-width:520px">
        <button id="again" style="border:var(--border) solid #111;background:#fff;color:#000;border-radius:999px;padding:12px 14px;font-weight:800">Try another batch</button>
        <a href="https://cataas.com/#/" target="_blank" rel="noopener" style="text-align:center;border:var(--border) solid #111;background:#fff;color:#000;border-radius:999px;padding:12px 14px;font-weight:800;display:inline-block">Powered by CATAAS</a>
      </div>
    </section>
  </div>

  <script>
  (function(){
    const TOTAL = 15;
    const stack = document.getElementById('stack');
    const bar = document.getElementById('bar');
    const summary = document.getElementById('summary');
    const likedGrid = document.getElementById('likedGrid');
    const likedCountEl = document.getElementById('likedCount');
    const totalCountEl = document.getElementById('totalCount');
    const again = document.getElementById('again');
    const howto = document.getElementById('howto');
    const pawsLayer = document.getElementById('paws');
    const btnLike = document.getElementById('btnLike');
    const btnNope = document.getElementById('btnNope');
    const emojisLayer = document.getElementById('emojis'); // NEW

    /** cards: { id, src } where src = https://cataas.com/cat/:id?width&height (stable) */
    let cards = [];
    let index = 0;
    let liked = [];

    const w = Math.round(Math.min(window.innerWidth*0.88, 340));
    const h = Math.round(Math.min(window.innerHeight*0.60, 500));
    const cardSrcFromId = (id)=> `https://cataas.com/cat/${id}?width=${w}&height=${h}`;

    /** Fetch one random cat JSON -> returns its stable id */
    async function getRandomCatId(){
      // CATAAS returns JSON when the request has application/json in headers.
      const res = await fetch('https://cataas.com/cat?json=true', {
        cache: 'no-store'   // fine to keep; doesn't trigger preflight
    });
    if (!res.ok) throw new Error('Cat JSON failed: ' + res.status);
    const data = await res.json();
    return data.id || data._id;
    }

    async function loadBatch(n=TOTAL){
        const promises = Array.from({length:n}, () =>
            getRandomCatId().catch(() => null)
        );
        const ids = (await Promise.all(promises)).filter(Boolean);
        const uniq = [...new Set(ids)];
        while (uniq.length < n) {
            const id = await getRandomCatId().catch(() => null);
            if (id && !uniq.includes(id)) uniq.push(id);
        }
        cards = ids.map(id => ({ id, src: cardSrcFromId(id) }));
        liked = []; index = 0; updateProgress();
        stack.innerHTML = '';
        summary.classList.remove('show');
        howto.style.display = 'flex';
        spawnPaws();
        spawnEmojis(); // NEW

        cards.forEach((c, i)=>{
            const card = createCard(c, i);
            stack.appendChild(card);
            // stacked look
            const depth = (cards.length - i - 1);
            const dy = depth * 6;
            card.style.transform = `translateY(-${dy}px)`;
        });
        focusTop();
        resetHints();
    }

    function createCard(item, i){
      const el = document.createElement('article');
      el.className = 'card';
      el.setAttribute('role','group');
      el.setAttribute('aria-label', `Cat ${i+1} of ${cards.length}`);

      const img = new Image();
      img.className = 'img';
      img.alt = 'A random cat from CATAAS';
      img.decoding = 'async';
      if(i === cards.length-1) img.loading = 'eager'; else img.loading = 'lazy';
      img.src = item.src;

      const ph = document.createElement('div'); ph.className='ph';
      const scrim = document.createElement('div'); scrim.className='scrim';

      const likeBadge = document.createElement('div'); likeBadge.className='badge like'; likeBadge.textContent='LIKE';
      const nopeBadge = document.createElement('div'); nopeBadge.className='badge nope'; nopeBadge.textContent='NOPE';

      const meta = document.createElement('div'); meta.className='meta';
      const title = document.createElement('div'); title.className='title'; title.textContent='CATAAS Kitty';
      const idx = document.createElement('div'); idx.className='idx'; idx.textContent=`${i+1} / ${cards.length}`;
      meta.append(title, idx);

      const clearPh = ()=> ph.remove();
      img.addEventListener('load', clearPh);

      el.append(ph,img,likeBadge,nopeBadge,scrim,meta);

      let startX=0, startY=0, curX=0, curY=0, dragging=false;
      function onPointerDown(e){ dragging=true; startX=e.clientX; startY=e.clientY; el.setPointerCapture(e.pointerId); }
      function onPointerMove(e){
        if(!dragging) return;
        curX = e.clientX - startX; curY = e.clientY - startY;
        const rot = curX/18;
        el.style.transition = 'none';
        el.style.transform = `translate(${curX}px, ${curY}px) rotate(${rot}deg)`;
        const likeOpacity = Math.min(Math.max((curX-40)/80,0),1);
        const nopeOpacity = Math.min(Math.max((-curX-40)/80,0),1);
        likeBadge.style.opacity = likeOpacity;
        nopeBadge.style.opacity = nopeOpacity;

        if(howto.style.display!=='none'){ howto.style.display='none'; }
        setHintIntensity(curX);
      }
      function onPointerUp(e){
        if(!dragging) return; dragging=false;
        el.releasePointerCapture(e.pointerId);
        const threshold = Math.min(120, window.innerWidth*0.22);
        if(curX > threshold){ swipe('right'); }
        else if(curX < -threshold){ swipe('left'); }
        else { resetCard(); }
      }
      function resetCard(){
        likeBadge.style.opacity=0; nopeBadge.style.opacity=0;
        el.style.transition = 'transform .25s ease';
        el.style.transform = '';
        resetHints();
      }
      function swipe(dir){
        const offX = (dir==='right'? window.innerWidth : -window.innerWidth)*1.1;
        el.style.transition = 'transform .32s ease-out, opacity .32s ease-out';
        el.style.transform = `translate(${offX}px, ${curY}px) rotate(${dir==='right'?20:-20}deg)`;
        el.style.opacity = .85;
        setTimeout(()=>{
          if(dir==='right'){ liked.push(item.src); meow(); } // store stable URL
          el.remove();
          index++;
          updateProgress();
          if(index>=cards.length){ showSummary(); }
          else { focusTop(); }
          resetHints();
        }, 320);
      }

      // expose swipe for external controls
      el._swipe = swipe;

      el.addEventListener('pointerdown', onPointerDown);
      el.addEventListener('pointermove', onPointerMove);
      el.addEventListener('pointerup', onPointerUp);
      el.addEventListener('pointercancel', onPointerUp);
      el.tabIndex = 0;
      el.addEventListener('keydown', (e)=>{
        if(e.key==='ArrowLeft'){ e.preventDefault(); swipe('left'); }
        if(e.key==='ArrowRight'){ e.preventDefault(); swipe('right'); }
      });

      return el;
    }

    function focusTop(){ const top = stack.lastElementChild; if(top) top.focus(); }

    function swipeTop(dir){
      const top = stack.lastElementChild;
      if(top && typeof top._swipe === 'function') top._swipe(dir);
    }

    function updateProgress(){
      const pct = cards.length? (index/cards.length)*100 : 0;
      bar.style.width = pct+'%';
    }

    function showSummary(){
      totalCountEl.textContent = cards.length;
      likedCountEl.textContent = liked.length;
      likedGrid.innerHTML = '';
      liked.forEach(src=>{
        const img = document.createElement('img');
        img.src = src; img.alt='Your liked cat'; img.loading='lazy';
        likedGrid.appendChild(img);
      });
      summary.classList.add('show');
      window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
      pawsLayer.style.opacity = .5;
      resetHints();
    }

    again.addEventListener('click', ()=> loadBatch(TOTAL));
    if(btnLike) btnLike.addEventListener('click', ()=> swipeTop('right'));
    if(btnNope) btnNope.addEventListener('click', ()=> swipeTop('left'));

    /* Hints removed */
    function setHintIntensity(){ /* no-op */ }
    function resetHints(){ /* no-op */ }

    /* Floating paws */
    function spawnPaws(){
      pawsLayer.innerHTML = '';
      const count = 14;
      for(let i=0;i<count;i++){
        const s = document.createElement('div'); s.className='paw';
        const dur = 12 + Math.random()*12; const left = Math.random()*100; const delay = -Math.random()*dur;
        const scale = 0.7 + Math.random()*0.6;
        s.style.left = left+'%'; s.style.animationDuration = dur+'s'; s.style.animationDelay = delay+'s';
        s.style.transform = `scale(${scale})`;
        s.innerHTML = `
          <svg width="120" height="120" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <defs>
              <linearGradient id="catGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ffb6c9"/>
                <stop offset="100%" stop-color="#ffc56f"/>
              </linearGradient>
            </defs>
            <g opacity="0.12">
              <path d="M20 55c0-6 5-18 14-22l10-6 8 8h26l8-8 9 6c9 5 15 16 15 22 0 32-25 48-50 48S20 87 20 55Z" fill="url(#catGrad)" stroke="#000" stroke-width="2"/>
              <circle cx="50" cy="58" r="4" fill="#000"/>
              <circle cx="76" cy="58" r="4" fill="#000"/>
              <path d="M50 74c8 5 16 5 24 0" fill="none" stroke="#000" stroke-width="3" stroke-linecap="round"/>
            </g>
          </svg>`;
        pawsLayer.appendChild(s);
      }
    }

    /* ====== NEW: Floating emoji spawner ====== */
    function spawnEmojis(){
      if(!emojisLayer) return;
      emojisLayer.innerHTML = '';
      const EMOJIS = ['😺','🐾','😻','🐈','❤️','💖'];

      // Increase how many are on screen at once
      const count = 48; // was 22

      for(let i=0;i<count;i++){
        const e = document.createElement('div');
        e.className = 'emo';
        e.textContent = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];

        const left = Math.random()*100;          // vw
        const dur  = 5 + Math.random()*7;        // was 10-24s, now 5-12s (faster)
        const delay = -Math.random()*dur;         // randomize phase
        const scale = 0.8 + Math.random()*0.9;    // 0.8-1.7
        const drift = (Math.random()*60 - 30) + 'px'; // -30..30px

        e.style.left = left + 'vw';
        e.style.animationDuration = dur + 's';
        e.style.animationDelay = delay + 's';
        e.style.setProperty('--s', scale);
        e.style.setProperty('--x', '0px');
        e.style.setProperty('--drift', drift);
        emojisLayer.appendChild(e);
      }
    }
    /* ======================================= */

    /* Meow */
    function meow(){
      try{
        const u = new SpeechSynthesisUtterance('meow');
        u.pitch = 1.4; u.rate = 1.1; u.volume = 0.6; speechSynthesis.speak(u);
      }catch(e){}
    }

    loadBatch(TOTAL);
  })();
  </script>
</body>
</html>
